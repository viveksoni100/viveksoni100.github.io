<!DOCTYPE html>
<html data-wf-page="5d71d4f8a19ee00c4530b26f" data-wf-site="5d71d4f8a19ee0afc230b258">

<head>
  <meta charset="utf-8">
  <title>Key Cloak</title>
  <meta name="description" content="A comprehensive guide to use key cloak (identity and access management tool) with spring boot">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/vivek-soni.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css"
    integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <script src="http://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script
    type="text/javascript">WebFont.load({ google: { families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic", "Merriweather:300,300italic,400,400italic,700,700italic,900,900italic", "Gothic A1:100,200,300,regular,500,600,700,800,900"] } });</script>
  <script
    type="text/javascript">!function (o, c) { var n = c.documentElement, t = " w-mod-"; n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch") }(window, document);</script>
  <link href="icons/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="icons/webclip.png" rel="apple-touch-icon">
  <style type="text/css">
    .code {
      background: #f4f4f4;
      border: 1px solid #ddd;
      border-left: 3px solid #f36d33;
      color: #666;
      page-break-inside: avoid;
      font-family: monospace;
      font-size: 15px;
      line-height: 1.6;
      margin-bottom: 1.6em;
      max-width: 100%;
      overflow: auto;
      padding: 1em 1.5em;
      display: block;
      word-wrap: break-word;
    }
  </style>
</head>

<body>
  <div class="section-header is-sticky">
    <div class="container space-between">
      <div data-collapse="medium" data-animation="default" data-duration="400" class="navbar w-nav">
        <div class="navbar-container style2 w-container">
          <a href="index.html" class="brand order-first w-nav-brand w--current">
            <h3 class="logotype">Vivek Soni &nbsp; </h3>
          </a>
          <nav role="navigation" class="nav-menu order-last w-nav-menu">
            <a href="about.html" class="nav-link w-nav-link">About</a>
            <a href="contact.html" class="nav-link w-nav-link">Contact</a>
            <a href="blog.html" class="nav-link w-nav-link w--current">Blog</a>
            <a href="policy.html" class="nav-link w-nav-link">Privacy Policy</a>
          </nav>
          <div class="menu-button order-last w-nav-button"><img src="images/burger-menu-icon-white-1.svg" width="22"
              alt="" class="burger-menu-icon white"><img src="images/burger-menu-icon-1.svg" width="22" alt=""
              class="burger-menu-icon"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="section is-header position-relative">
    <div class="container">
      <div class="col lg-12">
        <div class="breadcrumb margin-bottom-double"><a href="index.html">Home</a><span
            class="fa margin-left-small margin-right-small is-xsmall"></span>Blog<span
            class="fa margin-left-small margin-right-small is-xsmall"></span>Key Cloak</div>
        <h1 class="heading-beta">Securing Spring Boot Microservices with Keycloak (Identity and Access management tool)
        </h1>
      </div>
    </div>
    <div class="container flex-horizontal margin-bottom-double"></div>
    <div class="container margin-bottom-double">
      <div class="col lg-12">
        <div class="c-article__date">06 August 2022</div>
        <div class="c-article__date-divider"></div>
      </div>
    </div>
    <div class="container">
      <div class="col lg-3 md-12 md-order-last">
        <div class="c-article__related">
          <div class="margin-bottom-double text-small weight-is-black low-text-contrast"></div>
          <div data-delay="3000" data-animation="slide" data-autoplay="1" data-duration="500" data-infinite="1"
            class="c-article_related-slider w-slider">
            <div class="w-slider-mask">
              <div class="w-slide">
                <div>
                  <h4 class="margin-bottom">The main problem that Keycloak solves is to provide a secure and convenient
                    way for users to access multiple applications, without having to repeatedly enter their credentials
                  </h4>
                  <div class="text-small low-text-contrast"></div>
                </div>
              </div>
            </div>
            <div class="hidden w-slider-arrow-left">
              <div class="w-icon-slider-left"></div>
            </div>
            <div class="hidden w-slider-arrow-right">
              <div class="w-icon-slider-right"></div>
            </div>
            <div class="c-article_related-slider-nav w-slider-nav w-slider-nav-invert w-round"></div>
          </div>
        </div>
      </div>
      <div class="col lg-1 no-margin-bottom"></div>
      <div class="col lg-8 md-12" style="overflow: auto;">
        <!-- article starts -->
        <div class="rich-text w-richtext">
          <h3>What is Keycloak?</h3>
          <p>It is a tool for “Identity and Access Management”, Keycloak is an open-source tool currently licensed with
            Apache License 2.0. It is also an upstream project for Red Hat SSO.</p>
          <h3>Keycloak Features</h3>
          <ol>
            <li>
              <p><b style="font-weight: bold">Multiple Protocols Support :</b> As for now Keycloak supports
                three different protocols, namely - OpenID Connect, OAuth 2.0 and SAML 2.0.</p>
            </li>
            <li>
              <p><b style="font-weight: bold">SSO :</b> Keycloak has full support for Single Sign-On and Single
                Sign-Out.</p>
            </li>
            <li>
              <p><b style="font-weight: bold">Admin Console :</b> Keycloak offers web-based GUI where you can
                “click out” all configurations required by your instance to work as you desire.</p>
            </li>
            <li>
              <p><b style="font-weight: bold">User Identity and Accesses :</b> Keycloak can be used as a
                standalone user identity and access manager by allowing us to create users database with custom
                roles and groups. This information can be further used to authenticate users within our application
                and secure parts of it based on pre-defined roles.</p>
            </li>
            <li>
              <p><b style="font-weight: bold">Social Identity Providers :</b> Additionally, Keycloak allows us
                to use Social Identity Providers. It has built-in support Google, Twitter, Facebook, Stack Overflow
                but, in the end, you have to configure all of them manually from admin panel. The full list of
                supported social identity providers and their configuration manual can be found in Keycloak
                documentation.</p>
            </li>
            <center><img src="images/blogs-img/b_10/features.webp"
                class="responsive"></center>
            <br /><br />
          </ol>
          <h3>Distributions of Keycloak</h3>
          <ol>
            <li>
              <p><b style="font-weight: bold">Server :</b> Standalone application is downloadable from Keycloak
                page in form of a tar or zip archive with all scripts, docs, and assets needed to work normally. As
                for now, there are two main versions of this distribution: one is powered by WildFly server while
                the other is powered by Quarkus. It is now in preview stage so some unexpected error may occur.</p>
            </li>
            <li>
              <p><b style="font-weight: bold">Docker Image :</b> Distribution appropriate for Docker, Podman,
                Kubernetes, and OpenShift. There are two official docker images for Keycloak: one is held in Quay
                Container Registry - quay.io/keycloak/keycloak, the second one is held in Docker Hub -
                jboss/keycloak. You can download both of them with a simple docker pull command.</p>
            </li>
            <li>
              <p><b style="font-weight: bold">Operator :</b> Distribution for Kubernetes and OpenShift based on
                Operator SDK.</p>
            </li>
          </ol>
          <h3>Hands On!</h3>
          <p><b style="font-weight: bold;">1. Download Keyclock server <a
                href="https://www.keycloak.org/downloads">https://www.keycloak.org/downloads</a></p>
          <center><img src="images/blogs-img/b_10/1.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">Note : </b>for windows download ZIP package</p>
          <p><b style="font-weight: bold;">2. Start Keyclock server</b></p>
          <p>unzip the package and hit the following command : sh bin/kc.sh start-dev</p>
          <center><img src="images/blogs-img/b_10/2.webp"
              class="responsive"></center>
          <center><img src="images/blogs-img/b_10/3.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">3. Create Admin user</b></p>
          <center><img src="images/blogs-img/b_10/4.webp"
              class="responsive"></center>
          <center><img src="images/blogs-img/b_10/5.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">4. go to Administration console and login with created user</b></p>
          <center><img src="images/blogs-img/b_10/6.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">5. create a realm (a component that holds user, role and role based
              authentications)</b></p>
          <center><img src="images/blogs-img/b_10/7.webp"
              class="responsive"></center>
          <center><img src="images/blogs-img/b_10/8.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">6. create a client (a component that we use in our springboot app to
              communicate)</b></p>
          <center><img src="images/blogs-img/b_10/9.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">7. create a role</b></p>
          <center><img src="images/blogs-img/b_10/10.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">8. create a user and set username and password using credential tab</b></p>
          <center><img src="images/blogs-img/b_10/11.webp"
              class="responsive"></center>
          <center><img src="images/blogs-img/b_10/12.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">9. map user and roles</b></p>
          <center><img src="images/blogs-img/b_10/13.webp"
              class="responsive"></center>
          <p><b style="font-weight: bold;">10. add keycloak dependencies</b></p>
          <pre class="code">
              &lt;dependency&gt;
                  &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
                  &lt;artifactId&gt;keycloak-spring-boot-starter&lt;/artifactId&gt;
              &lt;/dependency&gt;
            </pre>
          <pre class="code">
              &lt;dependencyManagement&gt;
                &lt;dependencies&gt;
                  &lt;dependency&gt;
                    &lt;groupId>org.keycloak.bom&lt;/groupId&gt;
                    &lt;artifactId>keycloak-adapter-bom&lt;/artifactId&gt;
                    &lt;version>19.0.0&lt;/version&gt;
                    &lt;type>pom&lt;/type&gt;
                    &lt;scope>import&lt;/scope&gt;
                  &lt;/dependency&gt;
                &lt;/dependencies&gt;
              &lt;/dependencyManagement&gt;
              </pre>
          <p><b style="font-weight: bold;">11. add properties</b></p>
          <pre class="code">
                keycloak:
                  realm: demo-realm
                  auth-server-url: http://localhost:8080/auth
                  resource: keycloak-demo #client-id
                  public-client: true
                  bearer-only: true
            </pre>
          <p><b style="font-weight: bold;">12. create configuration class</b></p>
          <pre class="code">
              package com.javatechie.keycloak.config;

              import org.keycloak.adapters.springboot.KeycloakSpringBootConfigResolver;
              import org.keycloak.adapters.springsecurity.KeycloakConfiguration;
              import org.keycloak.adapters.springsecurity.authentication.KeycloakAuthenticationProvider;
              import org.keycloak.adapters.springsecurity.config.KeycloakWebSecurityConfigurerAdapter;
              import org.springframework.beans.factory.annotation.Autowired;
              import org.springframework.context.annotation.Bean;
              import org.springframework.context.annotation.Import;
              import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
              import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
              import org.springframework.security.config.annotation.web.builders.HttpSecurity;
              import org.springframework.security.core.authority.mapping.SimpleAuthorityMapper;
              import org.springframework.security.core.session.SessionRegistryImpl;
              import org.springframework.security.web.authentication.session.RegisterSessionAuthenticationStrategy;
              import org.springframework.security.web.authentication.session.SessionAuthenticationStrategy;

              @KeycloakConfiguration
              @EnableGlobalMethodSecurity(jsr250Enabled = true) //jsr250Enabled will allow us to write @RolesAllowed()
              @Import(KeycloakSpringBootConfigResolver.class)
              public class SecurityConfig extends KeycloakWebSecurityConfigurerAdapter {
                  /**
                   * Registers the KeycloakAuthenticationProvider with the authentication manager.
                   */
                  @Autowired
                  public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
                      KeycloakAuthenticationProvider authenticationProvider = new KeycloakAuthenticationProvider();
                      authenticationProvider.setGrantedAuthoritiesMapper(new SimpleAuthorityMapper());
                      auth.authenticationProvider(authenticationProvider);
                  }

                  /**
                   * Defines the session authentication strategy.
                   */
                  @Bean
                  @Override
                  protected SessionAuthenticationStrategy sessionAuthenticationStrategy() {
                      return new RegisterSessionAuthenticationStrategy(new SessionRegistryImpl());
                  }

                  @Override
                  protected void configure(HttpSecurity http) throws Exception {
                      super.configure(http);
                      http
                              .authorizeRequests()
                              .anyRequest().permitAll();
                  }
              }
          </pre>
          <p><b style="font-weight: bold;">13. configuring role in our code</b></p>

          <pre class="code">
            package com.javatechie.keycloak;

            import com.javatechie.keycloak.entity.Employee;
            import com.javatechie.keycloak.service.EmployeeService;
            import org.springframework.beans.factory.annotation.Autowired;
            import org.springframework.boot.SpringApplication;
            import org.springframework.boot.autoconfigure.SpringBootApplication;
            import org.springframework.http.ResponseEntity;
            import org.springframework.web.bind.annotation.GetMapping;
            import org.springframework.web.bind.annotation.PathVariable;
            import org.springframework.web.bind.annotation.RequestMapping;
            import org.springframework.web.bind.annotation.RestController;

            import javax.annotation.security.RolesAllowed;
            import java.util.List;

            @SpringBootApplication
            @RestController
            @RequestMapping("/employees")
            public class SpringBootKeycloakExampleApplication {

                @Autowired
                private EmployeeService service;

                //this method can be accessed by user whose role is user
                @GetMapping("/{employeeId}")
                @RolesAllowed("user")   // only user role can allow this method
                public ResponseEntity&lt;Employee&gt; getEmployee(@PathVariable int employeeId) {
                    return ResponseEntity.ok(service.getEmployee(employeeId));
                }

                //this method can be accessed by user whose role is admin
                @GetMapping
                @RolesAllowed("admin") // only admin role can allow this method
                public ResponseEntity&lt;List&lt;Employee&gt;&gt; findALlEmployees() {
                    return ResponseEntity.ok(service.getAllEmployees());
                }

                public static void main(String[] args) {
                    SpringApplication.run(SpringBootKeycloakExampleApplication.class, args);
                }

            }

            </pre>

          <p><b style="font-weight: bold;">14. testing our code using postman with following parameters</b></p>
          <pre>
                Note - in postman's authorization type select OAuth 2.0
                Access Token Url : http://localhost:8080/auth/realms/demo-realm/protocol/openid-connect/token
                Client ID : keycloak-demo
                Scope : openid
                Grant Type : Password Credentials
                Username : &lt;username&gt;
                Password : &lt;password&gt;
                Access token : &lt;access token&gt;
            </pre>
          <center><img src="images/blogs-img/b_10/14.webp"
              class="responsive"></center>
          <center><img src="images/blogs-img/b_10/15.webp"
              class="responsive"></center>
          <center><img src="images/blogs-img/b_10/16.webp"
              class="responsive"></center>
          <hr>
          <p>source : <a href="https://www.keycloak.org/">https://www.keycloak.org/</a></p>
          <p">source code : <a
              href="https://github.com/viveksoni100/keycloak_learning">https://github.com/viveksoni100/keycloak_learning</a>
            </p>
            <!-- article ends -->
        </div>
      </div>
    </div>
    <div class="decoration-rightside hidden-md"></div>
  </div>
  <div class="section is-dark no-padding-bottom">
    <div class="container">
      <div class="col text-align-center lg-7 block-centered no-margin-bottom md-12">
        <div class="pre-title">Get in touch</div>
        <h2>Let’s work together</h2>
        <div class="text-medium margin-bottom">Reach out if you have a concept for a website or mobile app or require
          guidance with product design. <a href="mailto:viveksoni100@gmail.com"><strong>contact me.</strong></a></div>
        <a href="mailto:viveksoni100@gmail.com" class="button-primary margin-bottom-double w-inline-block">
          <div class="button-primary-text lowercase"><i class="fas fa-envelope"></i>&nbsp;&nbsp;viveksoni100@gmail.com
          </div>
        </a>
        <a href="#" class="button-primary margin-bottom-double w-inline-block"
          style="background-color: #fdf556; color: #000000;">
          <div class="button-primary-text lowercase"><i class="fas fa-mobile"></i>&nbsp;&nbsp;+(91) 88661 28862</div>
        </a>
        <div class="flexh-space-between maxwidth300 margin-bottom-double">
          <a href="https://www.facebook.com/vivek.barbhaya" target="_blank"><i class="fab fa-facebook"></i></a>
          <a href="https://www.instagram.com/vivek_soni_100/" target="_blank"><i class="fab fa-instagram "></i></a>
          <a href="https://github.com/viveksoni100" target="_blank"><i class="fab fa-github"></i></a>
          <a href="https://www.linkedin.com/in/vivek-soni-797451178/" target="_blank"><i
              class="fab fa-linkedin"></i></a>
          <a href="https://join.skype.com/invite/weh9XYJ3okdJ" target="_blank"><i class="fab fa-skype"></i></a>
          <a href="https://mobile.twitter.com/vickyvivek100" target="_blank"><i class="fab fa-twitter"></i></a>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
</body>

</html>